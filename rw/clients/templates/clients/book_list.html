{% extends 'containers/base.html'%}
{%load client%}
{%block page-name%}
<style>
  #create-new-cod i {
    display: flex;
    justify-content: center;
    padding: 10px;
    color: grey;
    font-size: 70px;
  }

  .card .buttons {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .client_name {
    font-size: 15px;
    margin: 2px 0;
  }

  .table-hover>tbody>tr:hover {
    background-color: rgb(207, 255, 200);
  }
</style>

<h1>Загруженые книги</h1>
{%endif%}
{%endblock%}


{%block content%}

<div class="container">
  <a href="{%url 'clients:load_book' %}" class="btn btn-success">Создать книгу <i
      class="fa-solid fa-file-circle-plus"></i></a>
</div>

<br>
<div class="container">
  {% regroup books by book_date|date:"F" as book_mounth %}
  <table class="table table-striped table-hover">
    <thead>
      <tr class="table-primary">
        <th scope="col">Дата</th>
        <th scope="col">Тип</th>
        <th scope="col">Описание</th>
        <th scope="col">Контейнеров</th>
      </tr>
    </thead>
    <tbody>
      {%for mounth in book_mounth%}
      <tr>
        <td colspan="7" class="table-info">{{mounth.grouper}}</td>
      </tr>
      {%for book in mounth.list %}
      <tr class="client_link" href="{%url 'containers:show_client' book.pk %}">
        <td>
          {{book.book_date}}
        </td>
        <td>
          {{book.type}}
        </td>
        <td>{{book.description}}</td>
        <td>
          {%if book.containers_count%}
          {{book.containers_count}}
          {%else%}
          -
          {%endif%}
        </td>
      </tr>
      {%endfor%}
      {%endfor%}
    </tbody>
  </table>
</div>


{% if messages %}
{% for message in messages %}
<div class="toast-container position-absolute bottom-0 end-0 p-3">
  <div class="toast align-items-center text-white bg-success border-0 " role="alert" aria-live="assertive"
    aria-atomic="true" data-bs-deley="1000">
    <div class="d-flex">
      <div class="toast-body">
        {{message}}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
        aria-label="Close"></button>
    </div>
  </div>
</div>
{% endfor %}
{% endif %}



<script>
  $('tr.client_link').click(function () {
    let href = $(this).attr('href')
    window.location.href = href
  })

  $("tr").on('client_link', '.btn', function (e) {
    e.stopPropagation()
    // Show edit dialog
  });
</script>
<script>
  var toastElList = [].slice.call(document.querySelectorAll('.toast'))
  var toastList = toastElList.map(function (toastEl) {
    return new bootstrap.Toast(toastEl,)
  })
  toastList.forEach(toast => {
    toast.show()
  });

</script>

{%endblock%}