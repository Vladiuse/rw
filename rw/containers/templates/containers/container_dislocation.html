{% extends 'containers/base.html' %}
{%block page-name%}<h1>Дислокация контейнера</h1>{%endblock%}
{% block content %}
<style>
    .text-center{
        text-align: center;
    }
    .form-wrapper{
        margin-top: 50px;
        display: flex;
        justify-content: center;
    }
    form{
        max-width: 500px;
        width: 100%;
    }
    form .mb-3{
        display: flex;
        align-items: center;
    }
    form label{
        white-space: nowrap;
        margin-right: 10px;
        text-align: center;
        min-width: 200px;
    }
    .errors{
        color: red;
        text-align: center;
        width: 100%;
    }
    #result{
        margin-top: 50px;
        color: red;
        height: 50px;
    }
    #result h3{
        border: 3px solid red;
        display: inline;
        padding: 4px 12px;

    }
</style>
<h4 class="text-center">Последний документ: {{report.name}} за {{report.document_date|date:"d.m.Y"}}</h4>
<div class="container">
    <div  id="result" class="text-center" >
        <h3 style="display: none;"></h3>
    </div>
    <div class="form-wrapper">
        
        <form method="POST">
            <div class="mb-3">
              <label for="container" class="form-label">Номер контейнера:</label>
              <input type="text" class="form-control" id="container" aria-describedby="emailHelp" placeholder="ABCD1234567" minlength="11" maxlength="11" required name="container" pattern="[A-Z]{4}\d{7}" title="ABCD1234567">
            </div>
            <div class="mb-3">
              <label for="send_number" class="form-label">Номер накладной:</label>
              <input type="text" class="form-control" id="send_number" placeholder="12345678" required name="send_number" pattern="\d{8}" title="Номер состоит из 8цифр"/>
            </div>
            <div class="for-buttons-center mb-3">
                <button class="pure-material-button-contained" type="submit">Проверить</button>
                <button class="pure-material-button-text" type="reset">Отчистить</button>
            </div>
            <div class="mb-3">
                <p class="errors" id="error-text"></p>
            </div>
          </form>
    </div>
</div>
<script>
    var error_text = $('#error-text')
    var area_text = $('#result h3')
    var find_area_url = "{{ request.scheme }}://{{ request.META.HTTP_HOST }}{%url 'containers:container_dislocation' %}"
    $('form').submit(function(event){
        event.preventDefault()
        var container = $('#container').val()
        var send_number = $('#send_number').val()
        console.log(container, send_number)
        data = {
            'container': container,
            'send_number': send_number,
        }
        $.post(find_area_url, data=data,)
        .done(function(response){
            if (response['status']){
                ///    
                area_text.text(response['area'])
                area_text.show()
                error_text.hide()
            }
            else{
                error_text.show()
                error_text.text(response['msg'])
                area_text.hide()
            }
        })
        .fail(function(response){
            error_text.text('Req error!')
        })
    })
</script>

{%endblock%}